<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0035-logging - The Bee RFC Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="0030-protocol-messages.html">0030-protocol-messages</a></li><li class="chapter-item expanded "><a href="0031-configuration.html">0031-configuration</a></li><li class="chapter-item expanded "><a href="0033-network.html">0033-network</a></li><li class="chapter-item expanded "><a href="0034-ternary-hash.html">0034-ternary-hash</a></li><li class="chapter-item expanded "><a href="0035-logging.html" class="active">0035-logging</a></li><li class="chapter-item expanded "><a href="0036-ternary.html">0036-ternary</a></li><li class="chapter-item expanded "><a href="0037-ternary-numeric-conversion.html">0037-ternary-numeric-conversion</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Bee RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li>Feature name: <code>logging</code></li>
<li>Start date: 2020-05-23</li>
<li>RFC PR: <a href="https://github.com/iotaledger/bee-rfcs/pull/35">iotaledger/bee-rfcs#35</a></li>
<li>Bee issue: <a href="https://github.com/iotaledger/bee/issues/78">iotaledger/bee#78</a></li>
</ul>
<h1><a class="header" href="#summary" id="summary">Summary</a></h1>
<p>This RFC introduces a logging library - <code>log</code> - and some recommendations on how to log in the Bee project.</p>
<h1><a class="header" href="#motivation" id="motivation">Motivation</a></h1>
<p>Logging is done across almost all binary and library crates in the Bee project, so consistency is needed to provide a
better user experience.</p>
<h1><a class="header" href="#detailed-design" id="detailed-design">Detailed design</a></h1>
<p>Logging in Bee should be done through the <a href="https://crates.io/crates/log">log</a> crate (<code>A Rust library providing a lightweight logging facade</code>) which is the de-facto standard library for logging in the Rust ecosystem.</p>
<p>The <code>log</code> crate itself is just a frontend and supports the implementation of many different backends.</p>
<blockquote>
<p>It provides a single logging API that abstracts over the actual logging implementation. Libraries can use the logging
API provided by this crate, and the consumer of those libraries can choose the logging implementation that is most
suitable for its use case.</p>
</blockquote>
<h2><a class="header" href="#frontend" id="frontend">Frontend</a></h2>
<blockquote>
<p>Libraries should link only to the log crate, and use the provided macros to log whatever information will be useful
to downstream consumers.</p>
</blockquote>
<p>The <code>log</code> crate provides the following macros, from lowest priority to highest priority:</p>
<ul>
<li><code>trace!</code></li>
<li><code>debug!</code></li>
<li><code>info!</code></li>
<li><code>warn!</code></li>
<li><code>error!</code></li>
</ul>
<p>These macros have a usage similar to the <code>println!</code> macro.</p>
<p>A log request consists of a <code>target</code>, a <code>level</code>, and a <code>message</code>.</p>
<p>By default, the target represents the location of the log request, but may be overridden.</p>
<p>Example with default target:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>info!(&quot;Connected to port {} at {} Mb/s&quot;, conn_info.port, conn_info.speed);
<span class="boring">}
</span></code></pre></pre>
<p>Example with overridden target:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>info!(target: &quot;connection_events&quot;, &quot;Successful connection, port: {}, speed: {}&quot;, conn_info.port, conn_info.speed);
<span class="boring">}
</span></code></pre></pre>
<h2><a class="header" href="#backend" id="backend">Backend</a></h2>
<blockquote>
<p>Executables should choose a logging implementation and initialize it early in the runtime of the program. Logging
implementations will typically include a function to do this. Any log messages generated before the implementation is
initialized will be ignored.</p>
</blockquote>
<p>There are a lot of <a href="https://docs.rs/log/0.4.8/log/#available-logging-implementations">available backends</a> for the <code>log</code>
frontend.</p>
<p>This RFC opts for the <a href="https://docs.rs/fern">fern</a> backend which is a very complete one with an advanced configuration.</p>
<h3><a class="header" href="#initialization" id="initialization">Initialization</a></h3>
<p>The backend API is limited to one function call to initialize the logger. It is designed to be updatable without
breaking changes by taking a <code>LoggerConfig</code> configuration object and returning a <code>Result</code>.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn logger_init(config: LoggerConfig) -&gt; Result&lt;(), Error&gt;;
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#configuration" id="configuration">Configuration</a></h3>
<p>The following configuration - compliant with <a href="https://github.com/iotaledger/bee-rfcs/blob/master/text/0031-configuration.md">RFC 31</a> -
primarily allows configuring different outputs with different log levels.</p>
<p><code>config.rs</code></p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Clone)]
struct LoggerOutputConfig {
    name: String,
    level: LevelFilter,
    ...
}

#[derive(Clone)]
struct LoggerConfig {
    color: bool,
    outputs: Vec&lt;LoggerOutputConfig&gt;,
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p><code>config.toml</code></p>
<pre><code class="language-toml">[logger]
color = true
[[logger.outputs]]
name  = &quot;stdout&quot;
level = &quot;info&quot;
[[logger.outputs]]
name  = &quot;errors.log&quot;
level = &quot;error&quot;
</code></pre>
<p><strong>Note</strong>: <code>stdout</code> is a reserved name for the standard output of the console.</p>
<h3><a class="header" href="#errors" id="errors">Errors</a></h3>
<p>Since different backends may have different errors, we need to abstract them to provide a consistent <code>logger_init</code>
function.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug)]
#[non_exhaustive]
enum Error {
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p><strong>Note</strong>: The <code>Error</code> enum has to be <code>non_exhaustive</code> to allow further improving / extending the logger without
risking a breaking change.</p>
<h2><a class="header" href="#format" id="format">Format</a></h2>
<p>The following elements should appear in this order:</p>
<ul>
<li>Date in the <code>%Y-%m-%d</code> format e.g. <code>2020-05-25</code>;</li>
<li>Time in the <code>%H:%M:%S</code> format e.g. <code>10:23:03</code>;</li>
<li>Target e.g. <code>bee_node::node</code>;
<ul>
<li>The default target is preferred but can be overridden if needed;</li>
</ul>
</li>
<li>Level e.g. <code>INFO</code>;</li>
<li>Message e.g. <code>Initializing...</code>;</li>
</ul>
<p>All elements should be enclosed in brackets <code>[...]</code> with only a space between the level and the message.</p>
<p>Example: <code>[2020-05-25][10:23:03][bee_node::node][INFO] Initializing...</code></p>
<p><strong>Note</strong>: All messages should end either with <code>...</code> (3 dots) to indicate something potentially long-lasting is
happening, or with <code>.</code> (1 dot) to indicate events that just happened.</p>
<h1><a class="header" href="#drawbacks" id="drawbacks">Drawbacks</a></h1>
<p>No specific drawbacks using this library.</p>
<h1><a class="header" href="#rationale-and-alternatives" id="rationale-and-alternatives">Rationale and alternatives</a></h1>
<ul>
<li>The <code>log</code> crate is maintained by the rust team, so it is a widely used and trusted dependency in the Bee framework;</li>
<li>Most of the logging crates in the Rust ecosystem are actually backends for the <code>log</code> crate with different features;</li>
<li>It should be very easy to switch to a different backend in the future by only changing the initialization function;</li>
<li>There are a lot of <a href="https://docs.rs/log/0.4.8/log/#available-logging-implementations">available backends</a> but <code>fern</code>
offers a very fine-grained logging configuration;</li>
</ul>
<h1><a class="header" href="#unresolved-questions" id="unresolved-questions">Unresolved questions</a></h1>
<p>There are no open questions as this RFC is pretty straightforward and the topic of logging is not a complex one.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="0034-ternary-hash.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="0036-ternary.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="0034-ternary-hash.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="0036-ternary.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
