<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0044-secret-zeroize-drop - The Bee RFC Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="0030-protocol-messages.html">0030-protocol-messages</a></li><li class="chapter-item expanded "><a href="0031-configuration.html">0031-configuration</a></li><li class="chapter-item expanded "><a href="0033-network.html">0033-network</a></li><li class="chapter-item expanded "><a href="0034-ternary-hash.html">0034-ternary-hash</a></li><li class="chapter-item expanded "><a href="0035-logging.html">0035-logging</a></li><li class="chapter-item expanded "><a href="0036-ternary.html">0036-ternary</a></li><li class="chapter-item expanded "><a href="0037-ternary-numeric-conversion.html">0037-ternary-numeric-conversion</a></li><li class="chapter-item expanded "><a href="0041-shutdown.html">0041-shutdown</a></li><li class="chapter-item expanded "><a href="0042-secret-debug-display.html">0042-secret-debug-display</a></li><li class="chapter-item expanded "><a href="0044-secret-zeroize-drop.html" class="active">0044-secret-zeroize-drop</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Bee RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <ul>
<li>Feature name: <code>secret-zeroize-drop</code></li>
<li>Start date: 2020-07-08</li>
<li>RFC PR: <a href="https://github.com/iotaledger/bee-rfcs/pull/44">iotaledger/bee-rfcs#44</a></li>
<li>Bee issue: <a href="https://github.com/iotaledger/bee/issues/104">iotaledger/bee#104</a></li>
</ul>
<h1><a class="header" href="#summary" id="summary">Summary</a></h1>
<p>This RFC does not really introduce a feature but rather a recommendation when dealing with sensitive data; their memory
should be securely erased when not used anymore.</p>
<h1><a class="header" href="#motivation" id="motivation">Motivation</a></h1>
<p>When dealing with sensitive data like key materials (e.g. seeds, private keys, ...), it is wise to explicitly clear
their memory to avoid having them continue existing and potentially exposing them to an attack.</p>
<p>Since such an attack already assumes unauthorized access to the data, this technique is merely an exploit mitigation by
ensuring sensitive data is no longer available.</p>
<p>Useful links:</p>
<ul>
<li><a href="https://www.daemonology.net/blog/2014-09-04-how-to-zero-a-buffer.html">How to zero a buffer</a></li>
<li><a href="https://www.gnu.org/software/libc/manual/html_node/Erasing-Sensitive-Data.html">Erasing Sensitive Data</a></li>
<li><a href="https://wiki.sei.cmu.edu/confluence/display/c/MEM06-C.+Ensure+that+sensitive+data+is+not+written+out+to+disk">Ensure that sensitive data is not written out to disk</a></li>
<li><a href="https://security.stackexchange.com/questions/74280/would-it-be-good-secure-programming-practice-to-overwrite-a-sensitive-variable">Would it be good secure programming practice to overwrite a “sensitive” variable before deleting it?</a></li>
</ul>
<h1><a class="header" href="#detailed-design" id="detailed-design">Detailed design</a></h1>
<p>This task is made a bit more complex by compilers that have a tendency of removing zeroing of memory they deem pointless
when doing optimizations. It is then not as trivial as resetting the memory to 0.</p>
<p>These optimizations can however be bypassed by using <a href="https://en.wikipedia.org/wiki/Volatile_(computer_programming)">volatile memory</a>.</p>
<h2><a class="header" href="#zeroize-and-drop" id="zeroize-and-drop"><code>Zeroize</code> and <code>Drop</code></a></h2>
<p>This RFC recommends:</p>
<ul>
<li>implementing the following traits on sensitive data types:
<ul>
<li><a href="https://docs.rs/zeroize/1.1.0/zeroize/trait.Zeroize.html">Zeroize</a> to <code>Securely zero memory with a simple trait (Zeroize) built on stable Rust primitives which guarantee the operation will not be &quot;optimized away&quot;</code>;</li>
<li><a href="https://doc.rust-lang.org/std/ops/trait.Drop.html">Drop</a> <code>Used to run some code when a value goes out of scope. This is sometimes called a 'destructor'</code> and making it call <code>self.zeroize()</code>;</li>
</ul>
</li>
<li>having <code>Zeroize</code> and <code>Drop</code> as requirements of sensitive data traits;</li>
</ul>
<h2><a class="header" href="#examples" id="examples">Examples</a></h2>
<p>Traits requirements:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait PrivateKey: Zeroize + Drop {
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p>If the type is trivial, <code>Zeroize</code> and <code>Drop</code> can be  derived:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Zeroize)]
#[zeroize(drop)]
struct ExamplePrivateKey([u8; 32]);
<span class="boring">}
</span></code></pre></pre>
<p>Otherwise, <code>Zeroize</code> and <code>Drop</code> need to be manually implemented.</p>
<ul>
<li>
<p><code>Zeroize</code> implementation:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Zeroize for ExamplePrivateKey {
    fn zeroize(&amp;mut self) {
        ...
    }
}
<span class="boring">}
</span></code></pre></pre>
</li>
<li>
<p><code>Drop</code> implementation:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl Drop for ExamplePrivateKey {
    fn drop(&amp;mut self) {
        self.zeroize()
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>A <a href="https://doc.rust-lang.org/reference/procedural-macros.html">derive macro</a> <code>SecretDrop</code> could be written to derive
the <code>Drop</code> implementation that is always expected to be the same.</p>
</li>
</ul>
<p>Useful links:</p>
<ul>
<li><a href="https://users.rust-lang.org/t/handling-sensitive-data-in-memory/14388">Handling sensitive data in memory</a></li>
<li><a href="https://github.com/dalek-cryptography/curve25519-dalek/issues/11">Erasing secrets from memory (zero on drop)</a></li>
</ul>
<h1><a class="header" href="#drawbacks" id="drawbacks">Drawbacks</a></h1>
<p>There are no major drawbacks in doing that, except the little overhead it comes with.</p>
<h1><a class="header" href="#rationale-and-alternatives" id="rationale-and-alternatives">Rationale and alternatives</a></h1>
<p>The alternative is to not recommend or enforce anything and risk users exposing their sensitive data to attacks.</p>
<h1><a class="header" href="#unresolved-questions" id="unresolved-questions">Unresolved questions</a></h1>
<p>Even though this technique uses volatile memory and is probably effective most of the time the compiler is still free to
move all of the inner data to another part of memory without zeroing the original data since it doesn't consider the
value to be dropped yet. A solution to prevent the compiler moving things whenever possible would be to
<a href="https://doc.rust-lang.org/std/boxed/struct.Box.html">box</a> secrets and access them through <a href="https://doc.rust-lang.org/std/pin/index.html">Pin</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="0042-secret-debug-display.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="0042-secret-debug-display.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
